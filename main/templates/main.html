{% extends 'base.html' %}
{% load static %}

{% block meta %}
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<style>
.card:hover {
  transform: scale(1.05);
  transition: transform 0.1s ease;
}
</style>


<div class="h-8"></div>

<div class="p-2 mt-12 mb-6 relative text-center">
    <div class="bg-white border border-blue-300 shadow-lg rounded-lg p-6 space-y-4">
        <div id="product_cards" class="px-6 py-4 space-y-6 form-style overflow-y-auto">
        </div>
    </div>    
</div>


<script>
  async function getProduct() {
    return fetch("{% url 'product:show_json' %}").then((res) => res.json());
  }
  

  async function refreshCards(products = null) {
      const productCardContainer = document.getElementById("product_cards");

      // Clear existing cards and messages
      productCardContainer.innerHTML = "";

      // If no products are provided, fetch all products
      if (!products) {
          products = await getProduct();
      }

      // Check if products array is empty
      if (products.length === 0) {
          const noProductsMessage = document.createElement("div");
          noProductsMessage.className = "text-center text-gray-700 mt-4"; // Styling for the message
          noProductsMessage.innerHTML = `<p>No products found matching your search.</p>`;
          productCardContainer.appendChild(noProductsMessage);
          return;
      }

      // Set up dynamic columns using CSS Grid
      const gridContainer = document.createElement("div");
      gridContainer.className = "grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"; // Responsive columns

      // Generate product cards
      products.forEach((product) => {
          const productCard = document.createElement("div");

          // Create inner HTML for each product card
          productCard.innerHTML = `
              <div class="flex flex-col items-center shadow-lg rounded-lg md:flex border border-blue-300 p-4 transition-transform hover:scale-105 duration-300 ease-in-out card" 
                  data-name="${product.fields.name}" data-id="${product.pk}"">
                  <!-- Product Image -->
                  <img class="w-32 h-32 object-cover rounded-lg shadow-md border border-blue-200 mb-3" 
                      src="/media/${product.fields.image}" alt="${product.fields.name}" />

                  <!-- Product Details -->
                  <div class="text-center">
                      <h5 class="text-sm font-bold text-blue-800 mb-2">${product.fields.name}</h5>
                      <p class="text-xs text-gray-700 mb-1">
                          <span class="font-semibold text-blue-600">Category:</span> ${product.fields.category}
                      </p>
                      <p class="text-xs text-gray-700 mb-1">
                          <span class="font-semibold text-blue-600">Type:</span> ${product.fields.drug_type}
                      </p>
                      <p class="text-xs text-gray-700 mb-1">
                          <span class="font-semibold text-blue-600">Price:</span> ${product.fields.price}
                      </p>
                      <p class="text-xs text-gray-700 mb-1">
                          <span class="font-semibold text-blue-600">Availability:</span> ${product.fields.availibility ? 'Available' : 'Not Available'}
                      </p>
                  </div>
              </div>
          `;

          // Append each product card to the grid container
          gridContainer.appendChild(productCard);
      });

      // Add the grid to the main container
      productCardContainer.appendChild(gridContainer);
  }

  // Initial call to refreshCards to load all products
  refreshCards();
</script>
{% endblock content %}
